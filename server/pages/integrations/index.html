{% extends "_layouts/base.html" %}
{% set id = 'integrations' %}
{% set header_style = 'transparent light' %}
{% set cssPath = 'integrations' %}

{% block main %}
<script>console.log(JSON.parse('{{ categoryFiltered | dump }}'))</script>

<section class="container">
  <div class="integrations-hero">
    <h1>Integrations</h1>
    <p>Premier and community integrations to help your apps do more.</p>
  </div>

  <div class="integrations-featured">
  {% for i in heroFeatured %}
      <a href="/integrations/{{i.uid}}" class="integrations-card integrations-card--featured {% if i.data.premier === 'Yes' %}integrations-card--premier{% endif %}">
        <div class="integrations-card__image">
          <img src="{{i.data.logo.url}}" alt="{{ i.data.name }} logo">
        </div>
        <h1>{{ i.data.name }}</h1>
        <p>{{ i.data['short-description'] }}</p>
        <ul>
          {% if i.data['category-primary'] !== 'None' %}
            <li class="integrations-tag"> {{i.data['category-primary']}} </li>
          {% endif %}
          {% if i.data['category-secondary'] !== 'None' %}
            <li class="integrations-tag"> {{i.data['category-secondary']}} </li>
          {% endif %}
          {% if i.data['category-tertiary'] !== 'None' %}
            <li class="integrations-tag"> {{i.data['category-tertiary']}} </li>
          {% endif %}
        </ul>
    </a>
  {% endfor %}
  </div>

  <div class="integrations-list">
    <div class="integrations-list__filter">
      <h4>Categories</h4>
      <ul>
        {% for filter in filters %}
          <li class="{% if categoryFilter.slug === filter.slug %}active{% endif %}">
            <a href="/integrations{% if filter.slug !== 'all' %}/category/{{filter.slug}}{% endif %}">
              {{filter.name}}
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>

    <div class="integrations-list__results">
      {% if hasCategoryFilter %}
        {% if categoryFiltered.length %}
        <!-- Show integrations for a single category -->
          <div class="integrations-list__results-header">
            <h4>
              {{ categoryFilter.name }}
            </h4>
          </div>
          <div class="integrations-list__results-grid">
            {% for i in categoryFiltered %}
              <a href="/integrations/{{i.uid}}" class="integrations-card integrations-card--small {% if i.data.premier === 'Yes' %}integrations-card--premier{% endif %}">
                <div class="integrations-card__image">
                  <img src="{{i.data.logo.url}}" alt="{{ i.data.name }} logo">
                </div>
                <h2>{{ i.data.name }}</h2>
              </a>
            {% endfor %}
          </div>

        {% endif %}
      {% else %}
        <!-- Show all categories -->
        {% for category, array in categoryFeatured %}
          {% if array.length %}
            <div class="integrations-list__results-header">
              <h4>{{ category }}</h4>
              <a href="/integrations/category/{{category | lower | replace(" ", "-")}}">
                View all <ion-icon name="arrow-forward"></ion-icon>
              </a>
            </div>
            <div class="integrations-list__results-row">
              {% for i in array %}

                  <a href="/integrations/{{i.uid}}" class="integrations-card integrations-card--small {% if i.data.premier === 'Yes' %}integrations-card--premier{% endif %}">
                    <div class="integrations-card__image">
                      <img src="{{i.data.logo.url}}" alt="{{ i.data.name }} logo">
                    </div>
                    <h2>{{ i.data.name }}</h2>
                  </a>

              {% endfor %}
            </div>
          {% endif %}
        {% endfor %}
      {% endif %}

      <!-- Empty node that'll be filled with client side search results -->
      <div class="integrations-list__results-search"></div>

      <!-- The form is shown when there are no integrations matching the filter -->
      <div class="integrations-list__results-form {% if hasCategoryFilter and categoryFiltered.length === 0%} show {% endif %}">
        <h3>Not seeing what you're looking for? Suggest an integration.</h3>
        <div class="hubspot-override">
          <!--[if lte IE 8]>
          <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
          <![endif]-->
          <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>
          <script>
            hbspt.forms.create({
          	portalId: "3776657",
          	formId: "86c849f0-afd3-42d2-b2af-c3f8d71f21c7",
            css: ""
          });
          </script>
        </div>
      </div>
    </div>

  </div>
</section>
{% endblock %}
